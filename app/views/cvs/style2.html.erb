<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title><%= @cv.name %></title>
  <style>
    <%= render_scss("pdfs/style2.scss") %>
  </style>
  <%= render 'layouts/variables' %>
</head>
<body>
  <% sections = @cv.sections.order(:vertical_position) %>
  <% description_section = sections.find { |section| section.name == Section.get_names[:description_section] } %>
  <div class="cv2">
    <header class="cv2__header">
      <% if @cv.main_photo.attached? %>
        <div class="cv2__photo">
          <%= image_tag "data:image/png;base64,#{Base64.encode64(@cv.main_photo.download)}", class: 'cv2__photo-img' %>
        </div>
      <% end %>

      <div class="cv2__header-main">
        <div class="cv2__name">
          <%= "#{@cv.first_name} #{@cv.last_name}" %>
        </div>

        <% if description_section&.content.present? %>
          <div class="cv2__header-description">
            <div class="cv2__header-description-body">
              <%= description_section.content %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="cv2__header-contact">
        <div class="cv2__header-contact-list">
          <% if @cv.email.present? %>
            <span><strong><%= t('.email') %>:</strong> <%= @cv.email %></span>
          <% end %>

          <% if @cv.phone_number.present? %>
            <span><strong><%= t('.phone_number') %>:</strong> <%= @cv.phone_number %></span>
          <% end %>

          <% if @cv.address.present? %>
            <span><strong><%= t('.address') %>:</strong> <%= @cv.address %></span>
          <% end %>

          <% if @cv.birth_date.present? %>
            <span><strong><%= t('.birth_date') %>:</strong> <%= @cv.birth_date.strftime("%d.%m.%Y") %></span>
          <% end %>

          <% if @cv.sex != Cv.get_sexes[:unspecified] %>
            <span><strong><%= t('.sex') %>:</strong> <%= @cv.sex %></span>
          <% end %>

          <% if @cv.drivers_licence.present? %>
            <span><strong><%= t('.drivers_licence') %>:</strong> <%= @cv.drivers_licence %></span>
          <% end %>

          <% if @cv.linkedin.present? %><span>LinkedIn: <%= @cv.linkedin %></span><% end %>
          <% if @cv.github.present? %><span>GitHub: <%= @cv.github %></span><% end %>
          <% if @cv.website.present? %><span><%= t('.website') %>: <%= @cv.website %></span><% end %>
          <% if @cv.instagram.present? %><span>Instagram: <%= @cv.instagram %></span><% end %>
          <% if @cv.facebook.present? %><span>Facebook: <%= @cv.facebook %></span><% end %>
          <% if @cv.twitter.present? %><span>Twitter: <%= @cv.twitter %></span><% end %>
        </div>
      </div>
    </header>

    <main class="cv2__content">
      <% content_sections = [
        Section.get_names[:description_section],
        Section.get_names[:skills_section],
        Section.get_names[:interest_section],
        Section.get_names[:custom_section],
        Section.get_names[:privacy_policy_sections]
      ] %>
      <% sections.each do |section| %>
        <% next if content_sections.include?(section.name) && section.content.blank? && section.name != Section.get_names[:privacy_policy_sections] %>
        <% next if section == description_section %>

        <section class="cv2__section">
          <% unless section.name == Section.get_names[:privacy_policy_sections] || Section.get_names[:employments_section] %>
            <div class="cv2__section-title">
              <%= section.custom_name.presence || I18n.t(".cvs.style2.#{section.name}") %>
            </div>
          <% end %>

          <% case section.name %>
          <% when Section.get_names[:description_section],
                  Section.get_names[:skills_section],
                  Section.get_names[:interest_section],
                  Section.get_names[:custom_section] %>
            <div class="cv2__richtext"><%= section.content %></div>

          <% when Section.get_names[:employments_section] %>
            <div class="cv2__list">
              <% section.employments.order(:position).each do |employment| %>
                <div class="cv2__item">
                  <div class="cv2__item-head">
                    <div class="cv2__item-title"><%= employment.name %></div>
                    <div class="cv2__item-dates">
                      <%= employment.start_date.strftime("%m.%Y") %> – <%= employment.end_date.present? ? employment.end_date.strftime("%m.%Y") : I18n.t(".cvs.style2.current_work") %>
                    </div>
                  </div>
                  <div class="cv2__item-sub">
                    <%= [employment.employer, employment.city].compact.join(" • ") %>
                  </div>
                  <% if employment.description.present? %>
                    <div class="cv2__item-body"><%= employment.description %></div>
                  <% end %>
                </div>
              <% end %>
            </div>

          <% when Section.get_names[:educations_section] %>
            <div class="cv2__list">
              <% section.educations.order(:position).each do |education| %>
                <div class="cv2__item">
                  <div class="cv2__item-head">
                    <div class="cv2__item-title"><%= education.university %></div>
                    <div class="cv2__item-dates">
                      <%= education.start_date.strftime("%m.%Y") %> – <%= education.end_date.present? ? education.end_date.strftime("%m.%Y") : I18n.t(".cvs.style2.current") %>
                    </div>
                  </div>
                  <div class="cv2__item-sub">
                    <%= [education.city, education.faculty, education.specialisation].compact.join(" • ") %>
                  </div>
                </div>
              <% end %>
            </div>

          <% when Section.get_names[:courses_section] %>
            <div class="cv2__list">
              <% section.courses.order(:position).each do |course| %>
                <div class="cv2__item">
                  <div class="cv2__item-head">
                    <div class="cv2__item-title"><%= course.name %></div>
                    <div class="cv2__item-dates"><%= course.start_date.strftime("%m.%Y") %></div>
                  </div>
                  <div class="cv2__item-sub"><%= course.institution %></div>
                  <% if course.description.present? %>
                    <div class="cv2__item-body"><%= course.description %></div>
                  <% end %>
                </div>
              <% end %>
            </div>

          <% when Section.get_names[:certificates_section] %>
            <div class="cv2__list">
              <% section.certificates.order(:position).each do |certificate| %>
                <div class="cv2__item">
                  <div class="cv2__item-head">
                    <div class="cv2__item-title"><%= certificate.name %></div>
                    <div class="cv2__item-dates"><%= certificate.date.strftime("%m.%Y") %></div>
                  </div>
                  <% if certificate.description.present? %>
                    <div class="cv2__item-body"><%= certificate.description %></div>
                  <% end %>
                </div>
              <% end %>
            </div>

          <% when Section.get_names[:languages_section] %>
            <div class="cv2__chips">
              <% section.languages.order(:position).each do |language| %>
                <span class="cv2__chip">
                  <%= language.language %> — <%= Language.get_translations_languages_levels[language.language_level.to_sym] %>
                </span>
              <% end %>
            </div>

          <% when Section.get_names[:references_section] %>
            <div class="cv2__list">
              <% section.references.order(:position).each do |reference| %>
                <div class="cv2__item">
                  <div class="cv2__item-head">
                    <div class="cv2__item-title"><%= reference.company %></div>
                  </div>
                  <div class="cv2__item-sub">
                    <%= [reference.contact_person, reference.phone_number, reference.email].compact.join(" • ") %>
                  </div>
                  <% if reference.description.present? %>
                    <div class="cv2__item-body"><%= reference.description %></div>
                  <% end %>
                </div>
              <% end %>
            </div>

          <% when Section.get_names[:privacy_policy_sections] %>
            <div class="cv2__privacy"><%= section.content %></div>
          <% end %>
        </section>
      <% end %>
    </main>
  </div>
</body>
</html>
